<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Power Automate JSON – Simple Flow Viewer</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 20px;
      background: #f6f7f9;
    }
    textarea {
      width: 100%;
      height: 220px;
      font-family: monospace;
      margin-bottom: 10px;
    }
    button {
      padding: 8px 14px;
      cursor: pointer;
    }
    .card {
      border: 1px solid #ccc;
      background: #fff;
      border-radius: 6px;
      padding: 10px;
      margin: 10px;width: fit-content;
    }
    summary {
      font-weight: 600;
      cursor: pointer;
    }
    table {
      border-collapse: collapse;
      margin-top: 8px;

    }
    td, th {
      border: 1px solid #999;
      padding: 6px;
      vertical-align: top;
    }
    th {
      background: #eee;
      text-align: left;
    }
    pre {
      background: #f0f0f0;
      padding: 8px;
      overflow-x: auto;
      font-size: 12px;
    max-width: 700px;
    max-height: 400px;
    }
    .error {
      color: red;
      font-weight: 600;
      margin-top: 10px;
    }
    /* Level 1 */
table {
  background: #fcefe6;
}

/* Level 2 */
table table {
  background: #e8f3fc;
}

/* Level 3 */
table table table {
  background: #eef9f1;
}

/* Level 4 */
table table table table {
  background: #f6eefc;
}

/* Level 5 */
table table table table table {
  background: #fff6e5;
}

/* Level 6 */
table table table table table table {
  background: #eaf7f7;
}

/* Level 7 */
table table table table table table table {
  background: #f9eaf2;
}
  </style>
</head>
<body>

<h2>Power Automate JSON – Simple Flow Viewer</h2>

<textarea id="jsonInput" placeholder="Paste Power Automate flow JSON here..."></textarea>
<br />
<button id="generateBtn">Generate Flow</button>

<div id="error" class="error"></div>
<div id="output"></div>

<script>
  const jsonInput = document.getElementById("jsonInput");
  const generateBtn = document.getElementById("generateBtn");
  const output = document.getElementById("output");
  const errorDiv = document.getElementById("error");

  generateBtn.addEventListener("click", generate);

  function isScope(action) {
  return action.type === "Scope" || action.foreach || action.until;
}

function getScopeChildren(action) {
  return action.actions || action.foreach || action.until || {};
}



function label(text) {
  const div = document.createElement("div");
  div.style.marginTop = "8px";
  div.style.fontWeight = "600";
  div.textContent = text;
  return div;
}
  function generate() {
    output.innerHTML = "";
    errorDiv.textContent = "";

    let json;
    try {
      json = JSON.parse(jsonInput.value);
    } catch (e) {
      errorDiv.textContent = "Invalid JSON";
      return;
    }

    renderFlow(json);
  }

function renderFlow(json) {
  const def =
    json?.definition ||
    json?.properties?.definition ||
    {};

  if (!def.triggers && !def.actions) {
    throw new Error("No triggers/actions found in JSON");
  }

  if (def.triggers) renderSection("Triggers", def.triggers);
  if (def.actions) renderSection("Actions", def.actions);
}


  function renderSection(title, obj) {
    const section = document.createElement("div");
    section.innerHTML = `<h3>${title}</h3>`;
    Object.entries(obj).forEach(([name, value]) => {
      section.appendChild(renderAction(name, value));
    });
    output.appendChild(section);
  }

function renderAction(name, action) {
  const card = document.createElement("div");
  card.className = "card";

  const details = document.createElement("details");
  details.open = true;

  const summary = document.createElement("summary");
  summary.textContent = `${name} (${action.type || "unknown"})`;
  details.appendChild(summary);

  // CONDITION
  if (action.type === "If") {
    details.appendChild(renderCondition(action));
  }

  // SCOPE / LOOP
  else if (isScope(action)) {
    const container = document.createElement("div");
    Object.entries(getScopeChildren(action)).forEach(([childName, child]) => {
      container.appendChild(renderAction(childName, child));
    });
    details.appendChild(container);
  }

  // NORMAL ACTION WITH CHILDREN
  else if (action.actions) {
    details.appendChild(renderTable(action.actions));
  }

  const pre = document.createElement("pre");
  pre.textContent = JSON.stringify(action, null, 2);
  details.appendChild(pre);

  card.appendChild(details);
  return card;
}



function hasChildren(action) {
  return (
    action.actions ||
    action.foreach ||
    action.until ||
    action.else?.actions
  );
}


  function renderTable(children) {
    const table = document.createElement("table");
    const thead = document.createElement("thead");
    thead.innerHTML = "<tr><th>Action</th><th>Content</th></tr>";
    table.appendChild(thead);

    const tbody = document.createElement("tbody");

    Object.entries(children).forEach(([name, action]) => {
      const tr = document.createElement("tr");

      const tdName = document.createElement("td");
      tdName.textContent = name;

      const tdContent = document.createElement("td");
      tdContent.appendChild(renderAction(name, action));

      tr.appendChild(tdName);
      tr.appendChild(tdContent);
      tbody.appendChild(tr);
    });

    table.appendChild(tbody);
    return table;
  }

  function renderCondition(action) {
  const table = document.createElement("table");

  const thead = document.createElement("thead");
  thead.innerHTML = "<tr><th>TRUE</th><th>FALSE</th></tr>";
  table.appendChild(thead);

  const tbody = document.createElement("tbody");
  const tr = document.createElement("tr");

  const tdTrue = document.createElement("td");
  Object.entries(action.actions || {}).forEach(([n, a]) => {
    tdTrue.appendChild(renderAction(n, a));
  });

  const tdFalse = document.createElement("td");
  Object.entries(action.else?.actions || {}).forEach(([n, a]) => {
    tdFalse.appendChild(renderAction(n, a));
  });

  tr.appendChild(tdTrue);
  tr.appendChild(tdFalse);
  tbody.appendChild(tr);

  table.appendChild(tbody);
  return table;
}


</script>

</body>
</html>
