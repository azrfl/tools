<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>School Timetable Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      /* Base colors */
      --color-bg: #ffffff;
      --color-text: #1f2933;
      --color-muted: #6b7280;

      /* Theme (change once, affects all) */
      --color-theme: 59 130 246;
      /* blue-500 as RGB */
      --color-theme-soft: rgba(var(--color-theme), 0.12);
      --color-theme-medium: rgba(var(--color-theme), 0.25);

      /* Borders & radius */
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 14px;
      --border-color: #e5e7eb;

      /* Shadows */
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-focus: 0 0 0 3px var(--color-theme-soft);

      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 0.75rem;
      --space-lg: 1rem;

      /* Motion */
      --ease: cubic-bezier(0.4, 0, 0.2, 1);
      --duration-fast: 120ms;
      --duration-normal: 200ms;
    }

    body {
      font-family: system-ui, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 16px;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, .1);
    }

    h2 {
      margin-top: 0;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      padding-top: 8px;
    }

    #subjectStyleControls div label {
      font-size: 14px;
      font-weight: bold;
      line-height: 1.5;
    }

    #dayContent strong {
      width: 100px
    }

    #dayContent select {
      min-width: 60px
    }


    input,
    select,
    textarea,
    button {
      font: inherit;
    }

    select:disabled {
      background: #dedcdc;
      width: 60px;
      height: 30px;
      border-radius: 15px;
    }


    input,
    select,
    textarea {
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-color);
      background: #fff;
      transition: border-color var(--duration-fast) var(--ease),
        box-shadow var(--duration-fast) var(--ease);
    }

    input[type="number"] {
      text-align: right;
      width: 47px
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: rgb(var(--color-theme));
      box-shadow: var(--shadow-focus);
    }

    input::placeholder,
    textarea::placeholder {
      color: var(--color-muted);
    }

    input,
    select {
      max-width: fit-content;
    }


    textarea {
      resize: vertical;
      width: 200px
    }

    .chip {
      background: #e5e7eb;
      border-radius: 12px;
      padding: 4px 8px;
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .chip button {
      border: none;
      background: none;
      cursor: pointer;
      font-weight: bold;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding-top: 8px;
    }

    table {
      width: 1000px;
      border-collapse: collapse;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 10px 6px;
      text-align: center;
      position: relative;
    }

    th {
      background: #f7f7f7
    }

    .timeCell {
      font-weight: bold;
    }

    .timeCell .start,
    .timeCell .end {
      position: absolute;
      font-size: 11px;
      font-family: monospace;
      color: #0049a3;
    }

    .timeCell .start {
      left: 3px;
      top: 1px;
    }

    .timeCell .end {
      bottom: 1px;
      right: 3px
    }

    .dayCell {
      font-weight: bold;
    }

    .lunch {
      text-orientation: upright;
      font-weight: bold;
      vertical-align: middle;
    }

    input[type="color"] {


      cursor: pointer;
      /* Change cursor to pointer on hover */
    }

    .fontpicker {
      border: none;
      padding: 4px;
      height: 13px;
      border-radius: 50%;
      /* Add rounded corners */
      background-color: #727070;
      margin-right: 10px
    }

    .bgpicker {
      padding: 4px;

      border: 0px solid #727070;
      ;

      /* Add rounded corners */
      background-color: #f0f0f0;
    }


    #timeInputs input {
      width: 60px
    }

    .labelstart {
      width: 100px
    }

    @media print {
      .whide {
        display: none;
      }

      body {
        height: fit-content;
        margin: 0px;
        padding: 0px;
        background: #fff;
      }

      .card {
        box-shadow: none;
      }

      table {
        box-shadow: 2px 2px 3px #ccc;
      }

      #preview {
        height: 400px;
        width: 1000px;

      }

      .container {
        Width: 1005px;
        margin: 0px;
        background: none;
      }

      /* ---- B&W MODE ONLY ---- */

      table,
      td,
      th,
      .dayCell {
        border: 2px solid #b5b5b5;
      }




      body.bw-print .dayCell,
      body.bw-print .timeCell {
        background: transparent !important;
        color: #000 !important;
      }
    }

    button {
      padding: var(--space-sm) var(--space-lg);
      border-radius: var(--radius-md);
      border: 1px solid transparent;
      background: rgb(var(--color-theme));
      color: #fff;
      cursor: pointer;
      box-shadow: var(--shadow-sm);

    }

    .chip button {
      padding: 1px 1px
    }

    button:hover {
      background: #0049a3
    }

    button:active {
      transform: translateY(1px);
    }

    #timeInputs td,
    .rowt td {
      padding: 0px
    }

    #timeInputs td input,
    .rowt td select {
      border: none;
    }
  </style>

  <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
</head>

<body>

  <div class="container">

    <!-- A -->
    <div class="card  whide">
      <h2>Jadual Sekolah Builder</h2>

      <div class="row">
        <label class="labelstart">Day format</label>
        <select id="dayFormat"></select>

        <label>Total blocks (incl. R):</label>
        <input type="number" id="blocks" min="6" max="15" />


        <label>Recess Text:</label>
        <input type="text" id="breakText" placeholder="Lunch" />

        <label>2nd Half Start:</label>
        <input type="number" id="breakAt" min="1" />
      </div>



      <div class="row">
        <label class="labelstart">Subjects</label>

        <input id="subjectInput" placeholder="Enter Subject" /> <button onclick="showemoji()">üòÄ</button>
        <div class="chips" id="subjectChips"></div>

      </div>

      <emoji-picker emoji-version="15.0" class="light" id="emojidiv" style="display:none"></emoji-picker>
      <br>
      <table>
        <thead>
          <tr id="timeInputs"></tr>
        </thead>


        <tbody id="dayContent"></tbody>
      </table>
      <label>Header</label>
      <input id="headerText" />
      <br>
      <label>Footer</label>
      <textarea id="footerText"></textarea>
    </div>

    <!-- B -->
    <div class="card whide">
      <h2>Styling</h2>

      <div id="subjectStyles"></div>

      <div class="row">
        <label>Day/Time font size</label>
        <input type="range" id="fsTime" min="8" max="18" />
        <label>Subject font size</label>
        <input type="range" id="fsSubject" min="8" max="24" />
      </div>

      <div id="subjectStyleControls"></div>
      <div style="display:none">
        <label>Border color</label>
        <input type="color" id="borderColor" />
      </div>
    </div>

    <!-- C -->
    <div class="card" id="preview">
      <h2 id="prevHeader"></h2>
      <table id="table"></table>
      <p id="prevFooter"></p>
    </div>



    <div class="card whide">
      <h2>Print / Export PDF</h2>
      <button onclick="printColor()">Print (Color)</button>
      <button onclick="printBW()">Print (B & W)</button>
    </div>

  </div>
  <script>
    const picker = document.querySelector('emoji-picker');
    const input = document.getElementById('subjectInput');
    const emojis = document.getElementById('emojidiv');

    picker.addEventListener('emoji-click', (event) => {
      const emoji = event.detail.unicode;

      const start = input.selectionStart ?? input.value.length;
      const end = input.selectionEnd ?? input.value.length;

      input.value =
        input.value.slice(0, start) +
        emoji +
        input.value.slice(end);

      const cursor = start + emoji.length;
      input.focus();
      input.setSelectionRange(cursor, cursor);
      emojis.style.display = "none"
    });

    function showemoji() {
      if (emojis.style.display == "block") {
        emojis.style.display = "none"
      }
      else { emojis.style.display = "block" }


    }

    function printColor() {
      document.body.classList.remove("bw-print");
      window.print();
    }

    function printBW() {
      document.body.classList.add("bw-print");
      window.print();
      setTimeout(() => document.body.classList.remove("bw-print"), 100);
    }


    const DAY_FORMATS = [
      { name: "ISNIN-JUMAAT", value: ["ISNIN", "SELASA", "RABU", "KHAMIS", "JUMAAT"] },
      { name: "ISN-JUM", value: ["ISN", "SEL", "RAB", "KHA", "JUM"] },
      { name: "I-J", value: ["I", "S", "R", "K", "J"] },
      { name: "Monday-Friday", value: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"] },
      { name: "M-F", value: ["M", "T", "W", "T", "F"] },
      { name: "Sunday-Thursday", value: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday"] }
    ];
    const samplestate =
{
    "dayFormat": 0,
    "blocks": 12,
    "breakAt": 5,
    "breakText": "REHAT",
    "times": ["7:25","7:55","8:25","8:55","9:25","9:45","10:15","10:45","11:15","11:45","12:15","12:45","1:15"
    ],
    "subjects": [ "ÿ¨ÿßŸàŸä", "BIüí¨", "AQH", "üé®PSV", "PJ‚öΩÔ∏è", "MZüéº", "üë•üë•", "SNüî¨", "MTüßÆ", "BAüí¨", "TSMüîàÔ∏è", "ü©∫PK", "KKüëÆ", "SEJ", "ULUM", "RBT", "BMüí¨"
    ],
    "content": {

        "ISNIN": [
            "üë•üë•",
            "ÿ¨ÿßŸàŸä",
            "BIüí¨",
            "BIüí¨",
            "TJ",
            "BMüí¨",
            "BMüí¨",
            "AQH",
            "AQH",
            "AQH",
            "üé®PSV",
            "üé®PSV"
        ],
        "SELASA": [
            "MZüéº",
            "PJ‚öΩÔ∏è",
            "BMüí¨",
            "BMüí¨",
            "PER.",
            "SNüî¨",
            "SNüî¨",
            "MTüßÆ",
            "MTüßÆ",
            "BIüí¨",
            "BIüí¨"
        ],
        "RABU": [
            "BAüí¨",
            "BAüí¨",
            "BMüí¨",
            "BMüí¨",
            "",
            "TSMüîàÔ∏è",
            "TSMüîàÔ∏è",
            "ü©∫PK",
            "ü©∫PK",
            "KKüëÆ",
            "KKüëÆ",
            "KKüëÆ"
        ],
        "KHAMIS": [
            "PJ‚öΩÔ∏è",
            "SEJ",
            "SEJ",
            "BAüí¨",
            "",
            "SNüî¨",
            "SNüî¨",
            "BIüí¨",
            "BIüí¨",
            "MTüßÆ",
            "MTüßÆ"
        ],
        "JUMAAT": [
            "BIüí¨",
            "BIüí¨",
            "ULUM",
            "ULUM",
            "",
            "RBT",
            "RBT",
            "BMüí¨",
            "BMüí¨",
            "MTüßÆ"
        ]

    },
    "header": "4 GIGIH (sample)",
    "footer": "2026",
    "styles": {
        "subjectBg": {
            "üé®PSV": "hsl(1.5498411278855384,70%,85%)",
            "ÿ¨ÿßŸàŸä": "#e39292",
            "üáßüáÆ": "hsl(115.18329006305868,70%,85%)",
            "üí¨BI": "hsl(145.2249674058503,70%,85%)",
            "BIüí¨": "#c3e4f9",
            "BMüí¨": "#9dfbdf",
            "ü•∞AQH": "hsl(290.53322734053523,70%,85%)",
            "AQH": "#13fc03",
            "PJ‚öΩÔ∏è": "#f2f2f2",
            "MZüéº": "hsl(314.7039909341056,70%,85%)",
            "üë•üë•": "hsl(118.17244343699184,70%,85%)",
            "SNüî¨": "#3566f8",
            "MTüßÆ": "#d1ffe5",
            "ÿπÿ±ÿ®": "hsl(261.77666086609526,70%,85%)",
            "BAüí¨": "#ff00d0",
            "TASüó£Ô∏è": "hsl(34.65058713461855,70%,85%)",
            "TSMüîàÔ∏è": "hsl(215.64214037561592,70%,85%)",
            "üë®‚Äç‚öïÔ∏èPK": "hsl(286.270549851156,70%,85%)",
            "ü©∫PK": "hsl(316.8180099058607,70%,85%)",
            "KKüëÆ": "hsl(236.30525397790922,70%,85%)",
            "SEJ": "hsl(100.59704551661656,70%,85%)",
            "ULUM": "hsl(20.743083569617305,70%,85%)",
            "RBT": "hsl(203.8869316759505,70%,85%)"
        },
        "subjectColor": {
            "üé®PSV": "#000",
            "ÿ¨ÿßŸàŸä": "#3a2727",
            "üáßüáÆ": "#000",
            "üí¨BI": "#000",
            "BIüí¨": "#000",
            "BMüí¨": "#000",
            "ü•∞AQH": "#000",
            "AQH": "#000",
            "PJ‚öΩÔ∏è": "#000",
            "MZüéº": "#000",
            "üë•üë•": "#000",
            "SNüî¨": "#ffffff",
            "MTüßÆ": "#000",
            "ÿπÿ±ÿ®": "#000",
            "BAüí¨": "#000",
            "TASüó£Ô∏è": "#000",
            "TSMüîàÔ∏è": "#000",
            "üë®‚Äç‚öïÔ∏èPK": "#000",
            "ü©∫PK": "#000",
            "KKüëÆ": "#000",
            "SEJ": "#000",
            "ULUM": "#000",
            "RBT": "#000"
        },
        "border": "#5c5c5c",
        "dayBg": {},
        "fs": {
            "header": 12,
            "time": 12,
            "subject": 12,
            "footer": 12
        },
        "fsTime": 14,
        "fsSubject": 17
    }
}

    const state = JSON.parse(localStorage.getItem("tt")) || samplestate
     //{
     //dayFormat: 0, blocks: 6, breakAt: 3, breakText: "LUNCH",
     //times: Array(10).fill(""),
     //subjects: [],
     //content: {},
     //header: "", footer: "",
     //styles: { subjectBg: {}, subjectColor: {}, border: "#ccc", fsTime: 12, fsSubject: 12 }
     //};

    const $ = id => document.getElementById(id);
    const save = () => { localStorage.setItem("tt", JSON.stringify(state)); render(); };

    function render() {
      $("dayFormat").innerHTML = DAY_FORMATS.map((d, i) => `<option value="${i}">${d.name}</option>`).join("");
      $("dayFormat").value = state.dayFormat;
      $("blocks").value = state.blocks;
      $("breakAt").value = state.breakAt;
      $("breakText").value = state.breakText;
      $("fsTime").value = state.styles.fsTime;
      $("fsSubject").value = state.styles.fsSubject;
      $("borderColor").value = state.styles.border;

      $("timeInputs").innerHTML = "<th class='labelstart'>Time :</th>";
      for (let i = 0; i < state.blocks + 1; i++) {
        let celltd = document.createElement("td");
        const inp = document.createElement("input");
        inp.placeholder = `h:m ${i + 1} `;
        inp.value = state.times[i] || "";
        inp.oninput = e => {
          state.times[i] = e.target.value;
        };

        inp.onblur = () => {
          save();
        };
        celltd.append(inp);
        $("timeInputs").append(celltd);
      }

      $("subjectChips").innerHTML = "";
      state.subjects.forEach(s => {
        const c = document.createElement("div");
        c.className = "chip";
        c.innerHTML = `${s}<button><sup>‚úñÔ∏è</sup></button>`;
        c.querySelector("button").onclick = () => { state.subjects = state.subjects.filter(x => x !== s); save(); };
        $("subjectChips").append(c);
      });

      const days = DAY_FORMATS[state.dayFormat].value;
      $("dayContent").innerHTML = "";
      days.forEach(d => {
        state.content[d] = state.content[d] || Array(10).fill("");
        const row = document.createElement("tr");
        row.className = "rowt";
        row.innerHTML = `<th class="labelstart">${d}</th>`;
        for (let i = 0; i < state.blocks; i++) {
          let cellsel = document.createElement("td");
          const sel = document.createElement("select");

          const isBreak = i === state.breakAt - 1;

          sel.innerHTML = isBreak
            ? `<option>R</option>`
            : `<option></option>` + state.subjects.map(s => `<option>${s}</option>`).join("");

          sel.disabled = isBreak;

          sel.value = state.content[d][i] || "";

          sel.onchange = e => {
            state.content[d][i] = e.target.value;
            save();
          };
          cellsel.append(sel)
          row.append(cellsel);
        }
        $("dayContent").append(row);
      });

      $("prevHeader").textContent = state.header;
      $("prevFooter").textContent = state.footer;

      const t = $("table"); t.innerHTML = ""; t.style.borderColor = state.styles.border;

      const head = document.createElement("tr");

      head.innerHTML = `<th><sub>DAY</sub> &#9586; <sup>TIME</sup></th>`;
      let displayIndex = 1;

      for (let i = 0; i < state.blocks; i++) {
        const isBreak = i === state.breakAt - 1;
        const label = isBreak ? "R" : displayIndex++;

        const start = state.times[i] || "";
        const end = state.times[i + 1] || "";

        head.innerHTML += `
    <th class="timeCell" style="font-size:${state.styles.fsTime}px">
      <span class="start">${start}</span>
       ${label}
      <span class="end">${end}</span>
    </th>
  `;
      }
      t.append(head);

      days.forEach((d, di) => {
        const r = document.createElement("tr");
        r.innerHTML = `<th style="font-size:${state.styles.fsTime * 1.5}px" >${d}</th>`;
        for (let i = 0; i < state.blocks; i++) {
          if (i === state.breakAt - 1 && di === 0) {
            r.innerHTML += `
     <td class="lunch" rowspan="${days.length}">
       ${state.breakText.split("").join("<br>")}
     </td>`;
            continue;
          }
          if (i === state.breakAt - 1) continue;

          const s = state.content[d][i];
          r.innerHTML += `
   <td class="dayCell" style="
     background:${state.styles.subjectBg[s] || '#f2f2f2'};
     color:${state.styles.subjectColor[s] || '#000'};
     font-size:${state.styles.fsSubject}px">
     ${s || ""}
   </td>`;
        }
        t.append(r);
      });
    }

    $("dayFormat").onchange = e => { state.dayFormat = +e.target.value; save(); };
    $("blocks").oninput = e => { state.blocks = +e.target.value; save(); };
    $("breakAt").oninput = e => { state.breakAt = +e.target.value; save(); };
    $("breakText").oninput = e => { state.breakText = e.target.value; save(); };
    $("headerText").oninput = e => { state.header = e.target.value; save(); };
    $("footerText").oninput = e => { state.footer = e.target.value; save(); };
    $("fsTime").oninput = e => { state.styles.fsTime = +e.target.value; save(); };
    $("fsSubject").oninput = e => { state.styles.fsSubject = +e.target.value; save(); };
    $("borderColor").oninput = e => { state.styles.border = e.target.value; save(); };

    $("subjectInput").onkeyup = e => {
      if (e.key === "," || e.key === "Enter") {
        const v = e.target.value.replace(",", "").trim();
        if (v && !state.subjects.includes(v)) {
          state.subjects.push(v);
          state.styles.subjectBg[v] = `hsl(${Math.random() * 360},70%,85%)`;
          state.styles.subjectColor[v] = "#000";
        }
        e.target.value = ""; save();
      }; renderSubjectStyleControls()
    };



    function renderSubjectStyleControls() {
      const wrap = document.getElementById("subjectStyleControls");
      wrap.innerHTML = "<span>Set Background & Font color </span>";

      const row = document.createElement("div");
      row.className = "row";

      state.subjects.forEach(s => {
        state.styles.subjectBg[s] ||= `hsl(${Math.random() * 360},70%,85%)`;
        state.styles.subjectColor[s] ||= "#000000";

        const box = document.createElement("div");
        box.style.display = "flex";
        box.style.alignItems = "center";
        box.style.gap = "6px";
        box.style.background = state.styles.subjectBg[s];
        box.style.color = state.styles.subjectColor[s];

        box.innerHTML = `
    
      <input type="color" value="${state.styles.subjectBg[s]}" class="bgpicker" style="background-Color:${state.styles.subjectBg[s]}">
        <label>${s}</label>
      <input type="color" value="${state.styles.subjectColor[s]}" class="fontpicker" >
    `;

        const [bg, font] = box.querySelectorAll("input");
        bg.oninput = e => { state.styles.subjectBg[s] = e.target.value; bg.style.backgroundColor = e.target.value; box.style.backgroundColor = e.target.value; save(); };
        font.oninput = e => { state.styles.subjectColor[s] = e.target.value; box.style.color = e.target.value; save(); };

        row.append(box);
      });

      wrap.append(row);
    }




    render();
    renderSubjectStyleControls();
  </script>
</body>


</html>
